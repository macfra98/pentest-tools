# USAGE GUIDE #
# Import-Module <.\ldap_enum_dc.ps1>
#
# LIST for SAMACCOUNTTYPE=805306368...
# -> LDAPSearch -LDAPQuery "(samAccountType=805306368)"
#
# LIST for groups in domain...
# -> LDAPSearch -LDAPQuery "(objectclass=group)"
#
# LIST specific group attributes you are interested in...
# -> foreach ($group in $(LDAPSearch -LDAPQuery "(objectCategory=group")) {
# >> $group.properties | select {$_.cn}, {$_.member}
# >> }
#
# LIST members of specific group...
# -> $sales = LDAPSearch -LDAPQuery "(&(objectCategory=group) (cn=<Sales Department>))"
# -> $sales.properties.member
# ########### #

function LDAPSearch {
    param (
        [string]$LDAPQuery
    )

    $PDC =
[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().PdcRoleOwner.Name
    $DistinguishedName = ([adsi]'').distinguishedName

    $DirectoryEntry = New-Object System.DirectoryServices.DirectoryEntry("LDAP://$PDC/$DistinguishedName")

    $DirectorySearcher = New-Object System.DirectoryServices.DirectorySearcher($DirectoryEntry, $LDAPQuery)

    return $DirectorySearcher.FindAll()
}
